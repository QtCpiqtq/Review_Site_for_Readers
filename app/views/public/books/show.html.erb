<h2><%= @book.title %></h2>

<% if user_signed_in? %>
  <% if @book_id && current_user.added_to_favorites?(@book_id) %>
    <%= form_with url: favorite_book_path(@book_id, delete_sort: 1), method: :delete do |f| %>
        <%= f.submit 'お気に入りの本から解除する' %>
    <% end %>
  <% else %>
    <%= form_with url: favorite_books_path, method: :post do |f| %>
        <%= f.hidden_field :isbn, :value => @book.isbn %>
        <%= f.submit 'お気に入りの本に登録する' %>
    <% end %>
  <% end %>
  
  <% if @book_id && current_user.added_to_wish_lists?(@book_id) %>
    <%= form_with url: wish_list_path(@book_id, delete_sort: 1), method: :delete do |f| %>
        <%= f.submit '読みたい本から解除する' %>
    <% end %>
  <% else %>
    <%= form_with url: wish_lists_path, method: :post do |f| %>
        <%= f.hidden_field :isbn, :value => @book.isbn %>
        <%= f.submit '読みたい本に登録する' %>
    <% end %>
  <% end %>
<% end %>

<%= link_to 'この本のレビューを投稿する', new_book_review_path(@book.isbn) %>

<h3>みんなのレビュー</h3>

<%if Book.get_reviews(@book.isbn).present? %>
  <% Book.get_reviews(@book.isbn).each do |review| %>

    <% if review.user.image.attached? %>
      <%= image_tag review.user.get_image(100,100) %><br>
    <% else %>
      <p>no image</p>
    <% end %>

    <%= review.user.name %><br>

    <% if review.body.length > 50 %>
      <%= review.body.truncate(50) %><br>
    <% else %>
      <%= review.body %><br>
    <% end %>

    <%= link_to 'more', review_path(review.id) %>

  <% end %>

<% else %>
    <h4>まだレビューがありません</h4>
<% end %>

